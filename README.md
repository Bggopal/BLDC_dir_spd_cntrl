# BLDC motor Speed and direction control using Bidirectional ESC

Considered ccomponents

1. BLDC  -  A2212
2. ESC(20A) - Bidirectional
3. Pot 10K
4. Arduino UNO

## BLDC

BLDC Motor stands for Brush Less DC motor, at any given time only two Phase of the motor will be powered, so that current enters through one phase and leaves through other.  although BLDC motors are considered to be DC motors, they work with the help of Pulsed waves. The Electronic speed controller (ESC) converts the DC voltage from the battery in to pulses and provides it to the 3 wires of the Motor.

A feedback is necessary for a BLDC motor to rotate without jerking. That is, the ESC must be aware of the location and pole of the magnets in the rotor in order to properly energise the stator. This data can be obtained in two methods. The first is by installing a hall sensor inside the motor. The magnet will be detected by the hall sensor, which will convey the information to the ESC. A Sensord BLDC motor is a type of motor that is used in electric vehicles. The second way is to use the back EMF generated by the coils when the magnets cross them as a feedback to check for back EMF. This method does not require any additional hardware or cables because the phase wire itself is used as a feedback to check for back EMF.

<p align="center">
    <img src="https://user-images.githubusercontent.com/59637425/146050603-a9dc077e-fbdf-4bad-87e3-2963105e8191.png" width="350" height="350">
</p>

## ESC

The Electronic Speed Controller (ESC) transforms DC electricity from the battery into pulses and transfers them to the Motor's three wires. Only two phases of the motor will be powered at any given moment, allowing current to enter through one phase and exit through the other.

The controller  is to turn on the Phase wires of the BLDC motors in the sequence form so that the motor rotates. This is accomplished by measuring the **back EMF** of each wire and energising the coil precisely when the magnet crosses it.

The value range of **bidirectional ESCs** differs from that of unidirectional ESCs. The midway is where the motor comes to a halt. So the theoretical centre point is 180/2 = 90. The operation ranges from 90 to 180 degrees in one direction and from 90 to 0 degrees in the other.

<p align="center">
    <img src="https://user-images.githubusercontent.com/59637425/146049097-0581494b-6d70-4785-bab4-b3142c2260ad.png" width="350" height="350">
</p>

## Code Logic 

The given PWM signal should have a 20ms period, and the duty cycle can be changed to change the BLDC motor's speed. The same concept applies to controlling the position of servo motors, thus the Arduino programme uses the same servo library.

```
#include <Servo.h>
Servo BLDC;
byte bldc_pin = 9; // PWM pin
byte pot_pin = A0; // Pot pin
``` 
Setting the input and output features. 

```
void setup() 
{
  BLDC.attach(bldc_pin);
  BLDC.writeMicroseconds(1500); // make the ESC high
  delay(5000); // delay to power up
}

``` 
The analogue input value provided by the potentiometer is between 0 and 1023. We get inconsistent outcomes if we utilise these variables directly. As a result, we use the "map" command to change this value to a range of 0 to 180 that the ESC can understand.

The operation ranges from 90 to 180 degrees in one direction and from 90 to 0 degrees in the other. 

```
void loop() 
{
  int val = analogRead(0); // read input from potentiometer.
  int pwm = map(val, 0, 1023, 1100, 1900); // maps potentiometer values to PWM value.
  BLDC.writeMicroseconds(pwm); // Send signal to ESC.
}
```
